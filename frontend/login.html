<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>SpacePoint Inventory â€“ Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/api.js" defer></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <style>
        :root {
            --sp-primary: #241134;
            --sp-secondary: #653f84;
            --sp-light: #d7d2cb;
        }
    </style>

    <script defer>
        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value.trim();
            const errorEl = document.getElementById("error");
            errorEl.textContent = "";

            try {
                const data = await apiFetch("/auth/login", {
                    method: "POST",
                    body: JSON.stringify({ username, password }),
                });

                console.log("Login response:", data);

                // Pass instructor_id and user_id to setAuth function
                setAuth(data.token, data.role, data.username, data.instructor_id, data.id);

                console.log("Stored auth data:", {
                    token: sessionStorage.getItem("token"),
                    role: sessionStorage.getItem("role"),
                    username: sessionStorage.getItem("username"),
                    instructor_id: sessionStorage.getItem("instructor_id"),
                    user_id: sessionStorage.getItem("user_id")
                });

                if (data.role === "admin" || data.role === "operations") {
                    console.log("Redirecting to admin dashboard");
                    window.location.href = "admin_dashboard.html";
                } else if (data.role === "instructor") {
                    console.log("Redirecting to instructor dashboard");
                    window.location.href = "instructor_dashboard.html";
                } else {
                    console.log("Unknown role, redirecting to login");
                    errorEl.textContent = "Unknown user role";
                }
            } catch (err) {
                console.error("Login error:", err);
                errorEl.textContent = "Invalid username or password";
            }
        }
    </script>
</head>

<body class="min-h-screen bg-[#f5f5f5] flex items-center justify-center">
    <div class="bg-white shadow-2xl rounded-3xl flex flex-col md:flex-row w-full max-w-4xl overflow-hidden">
        <!-- Left: Logo / Brand -->
        <div class="md:w-1/2 bg-[#241134] text-white flex flex-col justify-center items-center p-8">
            <img src="SpacePointlogo.png" alt="SpacePoint Logo" class="h-20 mb-4" />
            <h1 class="text-2xl font-bold mb-2">SpacePoint Inventory</h1>
            <p class="text-sm text-[#D7d2cb] text-center">
                Track your CubeSats, modules, components, and workshops in one modern dashboard.
            </p>
        </div>

        <!-- Right: Login form -->
        <div class="md:w-1/2 p-8">
            <h2 class="text-xl font-semibold text-[#241134] mb-4">Sign in</h2>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-700 mb-1">Username</label>
                    <div class="relative">
                        <span class="absolute left-3 top-2.5 text-gray-400">
                            <i class="fa-regular fa-user"></i>
                        </span>
                        <input id="username" type="text"
                            class="w-full pl-9 pr-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#653f84]"
                            placeholder="admin / op1 / op2 / inst1" required />
                    </div>
                </div>

                <div>
                    <label class="block text-sm text-gray-700 mb-1">Password</label>
                    <div class="relative">
                        <span class="absolute left-3 top-2.5 text-gray-400">
                            <i class="fa-solid fa-lock"></i>
                        </span>
                        <input id="password" type="password"
                            class="w-full pl-9 pr-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#653f84]"
                            placeholder="admin123 / op123 / inst123" required />
                    </div>
                </div>

                <p id="error" class="text-red-500 text-sm"></p>

                <button type="submit"
                    class="w-full py-2 rounded-lg bg-purple-600 hover:bg-[#4f3069] text-white font-semibold flex items-center justify-center gap-2">
                    <i class="fa-solid fa-right-to-bracket"></i>
                    <span>Login</span>
                </button>
            </form>
        </div>
    </div>
</body>

</html>